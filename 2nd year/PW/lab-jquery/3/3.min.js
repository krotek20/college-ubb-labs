$(function () {
    const tiles = [];
    const tileNo = 16;
    let timeout = null;

    for (let i = 0; i < tileNo; i++) {
        tiles[i] = Math.floor(i / 2);
        $("<div/>", {
            id: `${i}`,
            "class": "tile"
        }).appendTo("#matrix");
    }
    for (let i = 0; i < tileNo; i++) {
        const j = Math.floor(Math.random() * 31) % tileNo;
        [tiles[i], tiles[j]] = [tiles[j], tiles[i]];
    }
    $(".tile").click(function () {
        const flippedTiles = $("#matrix .tile-flipped");
        if (!$(this).hasClass("tile-matched") && flippedTiles.length < 2) {
            // $(this).html($("<p></p>").text(tiles[Number($(this).attr("id"))]).css("font-size", 30)).addClass("tile-flipped");
            $(this).html($("<img>").attr("src",  "images/" + tiles[Number($(this).attr("id"))] + ".jpg")).addClass("tile-flipped");
        }

        clearTimeout(timeout);
        timeout = setTimeout(() => {
            if (flippedTiles.length >= 1) {
                const i = tiles[Number($(this).attr("id"))];
                const j = tiles[Number($(flippedTiles[0]).attr("id"))];
                $(this).removeClass("tile-flipped");
                $(flippedTiles[0]).removeClass("tile-flipped");
                if (i !== j) {
                    $(this).html("");
                    $(flippedTiles[0]).html("");
                } else {
                    $(this).addClass("tile-matched");
                    $(flippedTiles[0]).addClass("tile-matched");
                }
            }
        }, 1000);
    });
});